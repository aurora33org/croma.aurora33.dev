module.exports=[14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},66680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},72507,e=>{"use strict";let t={server:{port:parseInt(process.env.PORT||"3000",10),nodeEnv:"production"},upload:{maxFileSize:parseInt(process.env.MAX_FILE_SIZE||"10485760",10),maxFiles:parseInt(process.env.MAX_FILES||"20",10),allowedMimeTypes:["image/jpeg","image/jpg","image/png","image/webp"]},cleanup:{interval:parseInt(process.env.CLEANUP_INTERVAL||"15",10),fileTTL:parseInt(process.env.FILE_TTL||"3600",10)},listmonk:{enabled:"true"===process.env.LISTMONK_ENABLED,url:process.env.LISTMONK_URL||"",apiKey:process.env.LISTMONK_API_KEY||"",listId:process.env.LISTMONK_LIST_ID||""},storage:{baseDir:"/tmp/jobs"},supportedFormats:["jpeg","jpg","png","webp","gif"],outputFormats:["webp","jpeg","png"]};e.s(["config",0,t])},81838,e=>{"use strict";var t=e.i(72507);let r="\x1b[0m",s="\x1b[1m",a=()=>new Date().toISOString();e.s(["logger",0,{info:(e,...t)=>{console.log(`\x1b[36m[INFO]${r} ${s}${a()}${r} - ${e}`,...t)},success:(e,...t)=>{console.log(`\x1b[32m[SUCCESS]${r} ${s}${a()}${r} - ${e}`,...t)},warn:(e,...t)=>{console.warn(`\x1b[33m[WARN]${r} ${s}${a()}${r} - ${e}`,...t)},error:(e,...t)=>{console.error(`\x1b[31m[ERROR]${r} ${s}${a()}${r} - ${e}`,...t)},debug:(e,...i)=>{"development"===t.config.server.nodeEnv&&console.log(`\x1b[35m[DEBUG]${r} ${s}${a()}${r} - ${e}`,...i)}}])},61673,e=>{"use strict";var t=e.i(66680);let r={randomUUID:t.randomUUID},s=new Uint8Array(256),a=s.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let o=function(e,o,n){if(r.randomUUID&&!o&&!e)return r.randomUUID();var l=e,u=n;let c=(l=l||{}).random??l.rng?.()??(a>s.length-16&&((0,t.randomFillSync)(s),a=0),s.slice(a,a+=16));if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,o){if((u=u||0)<0||u+16>o.length)throw RangeError(`UUID byte range ${u}:${u+15} is out of buffer bounds`);for(let e=0;e<16;++e)o[u+e]=c[e];return o}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(c)};var n=e.i(81838);class l{jobs=new Map;createJob(){let e=o(),t={id:e,status:"created",uploadedFiles:[],processedFiles:[],settings:null,progress:0,totalFiles:0,processedCount:0,originalSize:0,compressedSize:0,error:null,createdAt:Date.now(),updatedAt:Date.now()};return this.jobs.set(e,t),n.logger.info(`Created new job: ${e}`),t}getJob(e){return this.jobs.get(e)}updateJob(e,t){let r=this.jobs.get(e);return r?(Object.assign(r,t,{updatedAt:Date.now()}),this.jobs.set(e,r),n.logger.debug(`Updated job ${e}:`,t),r):(n.logger.warn(`Attempted to update non-existent job: ${e}`),null)}updateProgress(e,t,r){let s=Math.round(t/r*100);return this.updateJob(e,{processedCount:t,progress:s,status:100===s?"completed":"processing"})}addUploadedFile(e,t,r){let s=this.jobs.get(e);return s?(s.uploadedFiles.push({filename:t,size:r}),s.totalFiles=s.uploadedFiles.length,s.originalSize+=r,s.updatedAt=Date.now(),this.jobs.set(e,s),s):null}addProcessedFile(e,t,r,s){let a=this.jobs.get(e);return a?(a.processedFiles.push({filename:t,originalSize:r,compressedSize:s,reduction:Math.round((r-s)/r*100)}),a.compressedSize+=s,a.updatedAt=Date.now(),this.jobs.set(e,a),a):null}setJobSettings(e,t){return this.updateJob(e,{settings:t})}setJobStatus(e,t,r=null){return this.updateJob(e,{status:t,error:r})}deleteJob(e){let t=this.jobs.delete(e);return t&&n.logger.info(`Deleted job from memory: ${e}`),t}getAllJobs(){return Array.from(this.jobs.values())}getJobStats(e){let t=this.jobs.get(e);return t?{id:t.id,status:t.status,progress:t.progress,totalFiles:t.totalFiles,processedCount:t.processedCount,originalSize:t.originalSize,compressedSize:t.compressedSize,reduction:t.originalSize>0?Math.round((t.originalSize-t.compressedSize)/t.originalSize*100):0,createdAt:t.createdAt,error:t.error}:null}}let u=global.jobManagerInstance||new l;e.s(["jobManager",0,u],61673)},82539,e=>{"use strict";var t=e.i(22734),r=e.i(14747),s=e.i(72507),a=e.i(81838);class i{baseDir=s.config.storage.baseDir;async initialize(){try{await t.promises.mkdir(this.baseDir,{recursive:!0}),a.logger.info(`Storage initialized at ${this.baseDir}`)}catch(e){throw a.logger.error("Failed to initialize storage:",e),e}}getJobDir(e){return r.default.join(this.baseDir,e)}getUploadDir(e){return r.default.join(this.getJobDir(e),"uploads")}getProcessedDir(e){return r.default.join(this.getJobDir(e),"processed")}async createJobDirectories(e){try{let r=this.getUploadDir(e),s=this.getProcessedDir(e);return await t.promises.mkdir(r,{recursive:!0}),await t.promises.mkdir(s,{recursive:!0}),a.logger.debug(`Created directories for job ${e}`),{uploadDir:r,processedDir:s}}catch(t){throw a.logger.error(`Failed to create directories for job ${e}:`,t),t}}async saveMetadata(e,s){try{let i=r.default.join(this.getJobDir(e),"metadata.json");await t.promises.writeFile(i,JSON.stringify(s,null,2)),a.logger.debug(`Saved metadata for job ${e}`)}catch(t){throw a.logger.error(`Failed to save metadata for job ${e}:`,t),t}}async getMetadata(e){try{let s=r.default.join(this.getJobDir(e),"metadata.json"),a=await t.promises.readFile(s,"utf-8");return JSON.parse(a)}catch(t){return a.logger.error(`Failed to read metadata for job ${e}:`,t),null}}async listFiles(e){try{return(await t.promises.readdir(e)).filter(e=>!e.startsWith("."))}catch(t){return a.logger.error(`Failed to list files in ${e}:`,t),[]}}async getFileStats(e){try{let r=await t.promises.stat(e);return{size:r.size,created:r.birthtime,modified:r.mtime}}catch(t){return a.logger.error(`Failed to get stats for ${e}:`,t),null}}async deleteJob(e){try{let r=this.getJobDir(e);return await t.promises.rm(r,{recursive:!0,force:!0}),a.logger.info(`Deleted job directory: ${e}`),!0}catch(t){return a.logger.error(`Failed to delete job ${e}:`,t),!1}}async cleanupOldJobs(e){try{let s=await t.promises.readdir(this.baseDir),i=Date.now(),o=0;for(let a of s){let s=this.getJobDir(a),n=r.default.join(s,"metadata.json");try{let r=await t.promises.stat(n);(i-r.mtime.getTime())/1e3>e&&(await this.deleteJob(a),o++)}catch(e){await this.deleteJob(a),o++}}return o>0&&a.logger.info(`Cleanup completed: removed ${o} old job(s)`),o}catch(e){return a.logger.error("Failed to cleanup old jobs:",e),0}}}let o=global.storageServiceInstance||new i;e.s(["storageService",0,o])},18642,e=>e.a(async(t,r)=>{try{let t=await e.y("node-cron-850d997d12dc4759");e.n(t),r()}catch(e){r(e)}},!0),82557,e=>e.a(async(t,r)=>{try{var s=e.i(18642),a=e.i(72507),i=e.i(82539),o=e.i(61673),n=e.i(81838),l=t([s]);[s]=l.then?(await l)():l;let u=global.cleanupServiceInstance||new class{task=null;isRunning=!1;start(){if(this.task)return void n.logger.warn("Cleanup service is already running");let e=`*/${a.config.cleanup.interval} * * * *`;this.task=s.default.schedule(e,async()=>{await this.cleanup()}),n.logger.info(`Cleanup service started (runs every ${a.config.cleanup.interval} minutes)`),setTimeout(()=>this.cleanup(),6e4)}async cleanup(){if(this.isRunning)return void n.logger.debug("Cleanup already in progress, skipping...");this.isRunning=!0,n.logger.info("Starting cleanup...");try{let e=await i.storageService.cleanupOldJobs(a.config.cleanup.fileTTL),t=o.jobManager.getAllJobs(),r=Date.now(),s=0;for(let e of t)(r-e.updatedAt)/1e3>a.config.cleanup.fileTTL&&(o.jobManager.deleteJob(e.id),s++);s>0&&n.logger.info(`Removed ${s} old job(s) from memory`),e>0||s>0?n.logger.success(`Cleanup completed: ${e} file jobs, ${s} memory jobs`):n.logger.debug("Cleanup completed: nothing to clean")}catch(e){n.logger.error("Cleanup failed:",e)}finally{this.isRunning=!1}}stop(){this.task&&(this.task.stop(),this.task=null,n.logger.info("Cleanup service stopped"))}async runNow(){return this.cleanup()}};e.s(["cleanupService",0,u]),r()}catch(e){r(e)}},!1),28228,e=>e.a(async(t,r)=>{try{e.i(61673);var s=e.i(82539),a=e.i(82557),i=t([a]);[a]=i.then?(await i)():i,(async function(){try{await s.storageService.initialize(),a.cleanupService.start()}catch(e){console.error("Failed to initialize services:",e)}})().catch(console.error),e.s([]),r()}catch(e){r(e)}},!1),95313,e=>{"use strict";class t extends Error{statusCode;details;constructor(e,t=500,r={}){super(e),this.statusCode=t,this.details=r,this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor)}}class r extends t{constructor(e="Resource"){super(`${e} not found`,404)}}class s extends t{constructor(e){super(e,400)}}e.s(["BadRequestError",()=>s,"NotFoundError",()=>r])},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},2508,(e,t,r)=>{"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},66397,(e,t,r)=>{try{var s=e.r(24361);if("function"!=typeof s.inherits)throw"";t.exports=s.inherits}catch(r){t.exports=e.r(2508)}},20141,(e,t,r)=>{t.exports=e.r(24361).deprecate},23469,(e,t,r)=>{var s=e.r(874),a=s.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return a(e,t,r)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=s:(i(s,r),r.Buffer=o),o.prototype=Object.create(a.prototype),i(a,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return a(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var s=a(e);return void 0!==t?"string"==typeof r?s.fill(t,r):s.fill(t):s.fill(0),s},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return a(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return s.SlowBuffer(e)}},56092,(e,t,r)=>{"use strict";var s=e.r(23469).Buffer,a=s.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(s.isEncoding===a||!a(e)))throw Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=n,t=4;break;case"base64":this.text=c,this.end=d,t=3;break;default:this.write=g,this.end=p;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=s.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function n(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,"�"}}(this,e,0);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var s=r.charCodeAt(r.length-1);if(s>=55296&&s<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function g(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}r.StringDecoder=i,i.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},i.prototype.text=function(e,t){var r=function(e,t,r){var s=t.length-1;if(s<r)return 0;var a=o(t[s]);return a>=0?(a>0&&(e.lastNeed=a-1),a):--s<r||-2===a?0:(a=o(t[s]))>=0?(a>0&&(e.lastNeed=a-2),a):--s<r||-2===a?0:(a=o(t[s]))>=0?(a>0&&(2===a?a=0:e.lastNeed=a-3),a):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var s=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,s),e.toString("utf8",t,s)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c4d6d7aa._.js.map